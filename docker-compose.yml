services:
  backend:
    build: ./backend
    ports:
      - "28000:8000"
    volumes:
      - ./backend/src:/app/src
      - ./prompts/prompt.md:/app/prompts/prompt.md:ro
      - ./prompts/prompt-chat.md:/app/prompts/prompt-chat.md:ro
    environment:
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
      - DASHSCOPE_VL_MODEL=${DASHSCOPE_VL_MODEL:-qwen-vl-plus}
      - ENABLE_THINKING=${ENABLE_THINKING}
      - PROMPT_FILE_PATH=/app/prompts/prompt.md
      - PROMPT_CHAT_FILE_PATH=/app/prompts/prompt-chat.md
      - UVICORN_RELOAD=1

  frontend:
    build: ./frontend
    ports:
      - "23456:3000"
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
    environment:
      # Next.js rewrites 使用此变量代理到后端（容器网络）
      - BACKEND_URL=http://backend:8000
    depends_on:
      - backend
